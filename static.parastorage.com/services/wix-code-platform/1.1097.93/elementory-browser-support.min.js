(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.elementorySupport=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var elementorySupportFactory=require(".");module.exports=elementorySupportFactory()},{".":3}],2:[function(require,module,exports){"use strict";module.exports={PARSE:"parsererror",ERROR:"error",ABORT:"abort",TIMEOUT:"timeout"}},{}],3:[function(require,module,exports){"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var _require=require("@wix/cloud-elementory-client-core"),serialize=_require.serialize,deserialize=_require.deserialize,errorTypes=require("./error-types"),getPathWithBaseUrl=require("./paths"),ONE_MINUTE=6e4,NO_XHR_STATUS_ERROR_MESSAGE="Request aborted",TIMEOUT_ERROR_MESSAGE="Request timed out",DEFAULT_WEB_METHOD_ERROR_MESSAGE="Promise in backend function rejected with undefined";module.exports=function(e,r,t){return{baseUrl:e,queryParameters:r,currentPath:t,options:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},errorTypes:errorTypes,getJSON:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.currentPath?location.href.replace(this.currentPath,e):getPathWithBaseUrl(this.baseUrl,e,this.queryParameters)),o=this.options,n=o.headers,i=void 0===n?{}:n,s=o.withCredentials,a=void 0!==s&&s,u=o.timeout,c=void 0===u?ONE_MINUTE:u,p=_objectSpread(_objectSpread({},i),{},{"Content-Type":"application/json"});return new Promise(function(e,o){var n=new XMLHttpRequest;function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=new Error(r);return t.xhr=n,t.errorType=e,t}n.withCredentials=a;var s=setTimeout(function(){o(i(errorTypes.TIMEOUT,TIMEOUT_ERROR_MESSAGE)),n.abort()},c);n.open("POST",t,!0),n.onerror=function(){return o(i(errorTypes.ERROR,n.statusText))},n.onreadystatechange=function(){if(4===n.readyState)if(clearTimeout(s),200===n.status)try{var r=deserialize(n.responseText),t=r.isError,a=r.payload;if(t){var u=void 0===a?new Error(DEFAULT_WEB_METHOD_ERROR_MESSAGE):a;o(u)}else e(a)}catch(e){o(i(errorTypes.PARSE,e.message))}else{var c=n.status?errorTypes.ERROR:errorTypes.ABORT,p=n.status?n.statusText:NO_XHR_STATUS_ERROR_MESSAGE;o(i(c,p))}},Object.keys(p).forEach(function(e){return n.setRequestHeader(e,p[e])}),n.send(serialize(r))})}}}},{"./error-types":2,"./paths":4,"@wix/cloud-elementory-client-core":5}],4:[function(require,module,exports){"use strict";var sanitize=function(t){return t.startsWith("?")||t.startsWith("&")?t.substr(1):t};module.exports=function(t,n,c){if(!c)return t+n;var r=sanitize(c);return-1===n.indexOf("?")?"".concat(t).concat(n,"?").concat(r):"".concat(t).concat(n,"&").concat(r)}},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deserializeResult=exports.deserialize=exports.serialize=void 0;var deserialize_1=require("./src/deserialize");Object.defineProperty(exports,"deserialize",{enumerable:!0,get:function(){return deserialize_1.deserialize}}),Object.defineProperty(exports,"deserializeResult",{enumerable:!0,get:function(){return deserialize_1.deserializeResult}});var serialize_1=require("./src/serialize");Object.defineProperty(exports,"serialize",{enumerable:!0,get:function(){return serialize_1.serialize}})},{"./src/deserialize":6,"./src/serialize":7}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deserializeResult=exports.deserialize=void 0;var cloud_elementory_protocol_1=require("@wix/cloud-elementory-protocol"),isSerializedError=function(e){return!!(null==e?void 0:e._elementoryError)},convertToErrorObject=function(e){var r=new Error(e.message);return r.stack=e.stack,r.name=e.name,r.code=e.code,r},deserializeResult=function(e){return isSerializedError(e)?convertToErrorObject(e):e};exports.deserializeResult=deserializeResult;var deserialize=function(e){var r=(0,cloud_elementory_protocol_1.convertFromCustomFormat)(JSON.parse(e)),o=r.result;return{isError:!!r.exception,payload:deserializeResult(o)}};exports.deserialize=deserialize},{"@wix/cloud-elementory-protocol":8}],7:[function(require,module,exports){"use strict";var __spreadArray=this&&this.__spreadArray||function(r,e,o){if(o||2===arguments.length)for(var t,i=0,l=e.length;i<l;i++)!t&&i in e||(t||(t=Array.prototype.slice.call(e,0,i)),t[i]=e[i]);return r.concat(t||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.serialize=void 0;var cloud_elementory_protocol_1=require("@wix/cloud-elementory-protocol"),serialize=function(r){return JSON.stringify((0,cloud_elementory_protocol_1.convertToCustomFormat)(__spreadArray([],r,!0)))};exports.serialize=serialize},{"@wix/cloud-elementory-protocol":8}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateBackendPackageWebMethodUrl=exports.generatePackageWebMethodUrl=exports.exceptionToWebMethodPayload=exports.resultToWebMethodPayload=exports.convertFromCustomFormat=exports.convertToCustomFormat=void 0;var converters_1=require("./src/converters");Object.defineProperty(exports,"convertToCustomFormat",{enumerable:!0,get:function(){return converters_1.convertToCustomFormat}}),Object.defineProperty(exports,"convertFromCustomFormat",{enumerable:!0,get:function(){return converters_1.convertFromCustomFormat}});var web_method_protocol_1=require("./src/web-method-protocol");Object.defineProperty(exports,"resultToWebMethodPayload",{enumerable:!0,get:function(){return web_method_protocol_1.resultToWebMethodPayload}}),Object.defineProperty(exports,"exceptionToWebMethodPayload",{enumerable:!0,get:function(){return web_method_protocol_1.exceptionToWebMethodPayload}}),Object.defineProperty(exports,"generatePackageWebMethodUrl",{enumerable:!0,get:function(){return web_method_protocol_1.generatePackageWebMethodUrl}}),Object.defineProperty(exports,"generateBackendPackageWebMethodUrl",{enumerable:!0,get:function(){return web_method_protocol_1.generateBackendPackageWebMethodUrl}})},{"./src/converters":12,"./src/web-method-protocol":14}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConvertersComposer=void 0;var mapValues_1=require("../mapValues"),isObjectButNotNull=function(t){return null!==t&&"object"==typeof t},ConvertersComposer=function(){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._converters=t}return t.prototype.convertToCustomFormat=function(t,r,o){var e;if(void 0===r&&(r=new Set),void 0===o&&(o=!1),isObjectButNotNull(t)){if(r.has(t))throw new TypeError("Converting circular structure to JSON");r.add(t)}if(Array.isArray(t))return this._convertArray(t,r);var n=null===(e=this._findConverterToCustomFormat(t))||void 0===e?void 0:e.convertToCustomFormat(t,o);return isObjectButNotNull(t)?this._convertObject(n,t,r):n},t.prototype.convertFromCustomFormat=function(t){var r,o=this,e=t;return Array.isArray(t)?e=t.map(function(t){return o.convertFromCustomFormat(t)}):isObjectButNotNull(t)&&(e=(0,mapValues_1.mapValues)(t,this.convertFromCustomFormat.bind(this))),null===(r=this._findConverterFromCustomFormat(e))||void 0===r?void 0:r.convertFromCustomFormat(e)},t.prototype._convertObject=function(t,r,o){var e,n=this;return e="function"==typeof t.toJSON?(0,mapValues_1.mapValues)(t.toJSON(),function(t){return n.convertToCustomFormat(t,o)}):(0,mapValues_1.mapValues)(t,function(t){return n.convertToCustomFormat(t,o)}),o.delete(r),e},t.prototype._convertArray=function(t,r){var o=this,e=t.map(function(t){return o.convertToCustomFormat(t,r,!0)});return r.delete(t),e},t.prototype._findConverterFromCustomFormat=function(t){return this._converters.find(function(r){return r.canConvertFromCustomFormat(t)})},t.prototype._findConverterToCustomFormat=function(t){return this._converters.find(function(r){return r.canConvertToCustomFormat(t)})},t}();exports.ConvertersComposer=ConvertersComposer},{"../mapValues":13}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DateConverter=void 0;var isDateString=function(t){return!Number.isNaN(Date.parse(t))},DateConverter=function(){function t(){}return t.prototype.canConvertToCustomFormat=function(t){return t instanceof Date},t.prototype.convertToCustomFormat=function(t){return{$date:t.toISOString()}},t.prototype.canConvertFromCustomFormat=function(t){return this._isObjectWith$Date(t)&&"string"==typeof t.$date&&isDateString(t.$date)},t.prototype.convertFromCustomFormat=function(t){return new Date(t.$date)},t.prototype._isObjectWith$Date=function(t){return!!t&&"object"==typeof t&&"$date"in t},t}();exports.DateConverter=DateConverter},{}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DefaultConverter=void 0;var DefaultConverter=function(){function t(){}return t.prototype.canConvertToCustomFormat=function(){return!0},t.prototype.convertToCustomFormat=function(t,o){return o&&void 0===t?null:t},t.prototype.canConvertFromCustomFormat=function(){return!0},t.prototype.convertFromCustomFormat=function(t){return t},t}();exports.DefaultConverter=DefaultConverter},{}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertFromCustomFormat=exports.convertToCustomFormat=void 0;var ConvertersComposer_1=require("./ConvertersComposer"),DateConverter_1=require("./DateConverter"),DefaultConverter_1=require("./DefaultConverter"),composedConverters=new ConvertersComposer_1.ConvertersComposer(new DateConverter_1.DateConverter,new DefaultConverter_1.DefaultConverter),convertToCustomFormat=function(e){return composedConverters.convertToCustomFormat(e)};exports.convertToCustomFormat=convertToCustomFormat;var convertFromCustomFormat=function(e){return composedConverters.convertFromCustomFormat(e)};exports.convertFromCustomFormat=convertFromCustomFormat},{"./ConvertersComposer":9,"./DateConverter":10,"./DefaultConverter":11}],13:[function(require,module,exports){"use strict";function mapValues(e,a){var r={};return Object.keys(e).forEach(function(s){var t=a(e[s]);void 0!==t&&(r[s]=t)}),r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapValues=void 0,exports.mapValues=mapValues},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateBackendPackageWebMethodUrl=exports.generatePackageWebMethodUrl=exports.exceptionToWebMethodPayload=exports.resultToWebMethodPayload=void 0;var converters_1=require("./converters"),resultToWebMethodPayload=function(e,o){var t=o?JSON.parse(JSON.stringify(e,o)):(0,converters_1.convertToCustomFormat)(e);return void 0===t?{}:{result:t}};exports.resultToWebMethodPayload=resultToWebMethodPayload;var exceptionToWebMethodPayload=function(e,o,t){return void 0===o&&(o=function(e){return e}),void 0===t&&(t=function(e){return""}),{result:e instanceof Error?{message:o(e.message),name:e.name,stack:t(e.stack),code:e.code,_elementoryError:!0}:e,exception:!0}};exports.exceptionToWebMethodPayload=exceptionToWebMethodPayload;var generatePackageWebMethodUrl=function(e,o){return"/_webMethods/packages/".concat(encodeURIComponent(e),"/").concat(o,".ajax")};exports.generatePackageWebMethodUrl=generatePackageWebMethodUrl;var generateBackendPackageWebMethodUrl=function(e,o){return generatePackageWebMethodUrl("".concat(e,"-backend"),o)};exports.generateBackendPackageWebMethodUrl=generateBackendPackageWebMethodUrl},{"./converters":12}]},{},[1])(1)});